---
# Create the initial Chess deployment: web service and mongo
#
# Work in progress!
# 
# * remove fixed image version
# * side-by-side for canary release
# * map volume in mongo
# 
name: chess:1.0
gateways: 
  5000: 
    virtual_hosts: [
      "chessvamp.faux.ninja"
    ]
    routes: chess/web
clusters:
  chess:
    services:
      breed:
        name: chess:300
        deployable: stuartleeks/chesstest:300
        ports:
          web: 5000/http
        environment_variables:
          mongodbConnectionString: mongodb://$db.host:$db.ports.mongo
        dependencies:
          db: mongo 
      scale:
        cpu: 1
        memory: 512MB
        instances: 1
  db:
    services:
      breed: 
        name: mongo
        deployable: mongo
        ports:
          mongo: 27017/tcp
      scale:
        cpu: 1
        memory: 256MB
        instances: 1
